<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—èª 3 æœŸæœ«å ±å‘Š - å¹¼æ•™ç³»(åŸå°ˆç­) - ç§€å§‘å·’é˜¿ç¾èª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { 
            background-color: #fff1f2; /* æ·ºç«ç‘°ç´…åº•è‰² */
            font-family: 'Noto Sans TC', sans-serif; 
        }
        .amis-text {
            line-height: 2.2;
            letter-spacing: 0.02em;
        }
        .student-table th {
            background-color: #881337; /* Rose 900 */
            color: #fff;
            font-weight: 600;
        }
        .page-title-gradient {
            background: linear-gradient(135deg, #be123c 0%, #e11d48 100%);
        }
        /* åˆ†é åˆ‡æ›å‹•ç•« */
        .page-section {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        .page-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å°è¦½åˆ—æŒ‰éˆ• */
        .nav-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .nav-btn.active {
            background-color: white;
            color: #881337;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav-btn.inactive {
            color: #fecdd3; /* Rose 200 */
        }
        .nav-btn.inactive:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
        }

        /* éŒ„éŸ³èˆ‡è¨ˆæ™‚å‹•ç•« */
        @keyframes pulse-red {
            0%, 100% { background-color: #fee2e2; }
            50% { background-color: #fca5a5; }
        }
        .timer-running {
            animation: pulse-red 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse-record {
            0% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(225, 29, 72, 0); }
            100% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0); }
        }
        .recording-active {
            animation: pulse-record 1.5s infinite;
            background-color: #e11d48 !important;
            border-color: #e11d48 !important;
            color: white !important;
        }

        /* æ™‚ç¨‹è¡¨å¡ç‰‡ */
        .sch-card {
            flex: 1;
            background: white;
            padding: 1rem;
            border-radius: 0.75rem;
            border-left: 4px solid #be123c;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            min-width: 200px;
        }
        .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        .badge.final { background-color: #ffe4e6; color: #9f1239; border: 1px solid #fecdd3; }
        .time-col { font-family: monospace; font-weight: 700; color: #be123c; }

        /* é¦–é å¡ç‰‡ */
        .home-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .home-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(190, 18, 60, 0.15);
        }
    </style>
</head>
<body class="min-h-screen pb-12">

    <!-- é ‚éƒ¨å°è¦½åˆ— -->
    <nav class="bg-rose-900 text-white p-4 shadow-lg mb-0 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fas fa-university text-rose-300"></i> 
                <div>
                    æ—èª 3 èª²ç¨‹å…¥å£ç¶² - ç§€å§‘å·’é˜¿ç¾èª
                    <span class="text-xs text-rose-200 block font-normal">Indigenous Language Learning Portal (Siwkolan 'Amis)</span>
                </div>
            </h1>
            
            <div class="flex gap-2 bg-rose-950/50 p-1 rounded-lg overflow-x-auto">
                <button onclick="switchPage('home')" id="nav-home" class="nav-btn active">
                    <i class="fas fa-home"></i> <span class="hidden sm:inline">é¦–é  Home</span>
                </button>
                <button onclick="switchPage('schedule')" id="nav-schedule" class="nav-btn inactive">
                    <i class="fas fa-calendar-alt"></i> <span class="hidden sm:inline">æ™‚ç¨‹è¡¨ Schedule</span>
                </button>
                <button onclick="switchPage('exam')" id="nav-exam" class="nav-btn inactive">
                    <i class="fas fa-laptop-code"></i> <span class="hidden sm:inline">æ¸¬é©—ç³»çµ± Exam</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- ========================================== -->
    <!-- é é¢ 1: é¦–é  (Home View) - æ–°å¢ -->
    <!-- ========================================== -->
    <div id="view-home" class="page-section active max-w-6xl mx-auto p-6">
        
        <!-- Welcome Hero -->
        <div class="bg-gradient-to-br from-rose-800 to-rose-600 rounded-3xl p-10 text-white shadow-2xl mb-10 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-20 -mt-20 blur-3xl"></div>
            <div class="relative z-10">
                <span class="bg-rose-500/50 border border-rose-400/50 text-white text-xs font-bold px-3 py-1 rounded-full mb-4 inline-block">
                    2025-2026 å­¸å¹´åº¦
                </span>
                <h1 class="text-4xl md:text-5xl font-extrabold mb-4 leading-tight">
                    æ­¡è¿ä¾†åˆ° <br>ç§€å§‘å·’é˜¿ç¾èªæœŸæœ«å ±å‘Š
                </h1>
                <p class="text-rose-100 text-lg max-w-2xl mb-8">
                    Welcome to the Final Presentation Portal. This platform assists students in preparing for their oral exams, checking schedules, and recording their presentations.
                </p>

                <!-- èª²ç¨‹è³‡è¨Š -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 bg-white/10 p-6 rounded-2xl border border-white/20 backdrop-blur-sm">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-rose-500 flex items-center justify-center"><i class="fas fa-chalkboard-teacher"></i></div>
                        <div>
                            <div class="text-xs text-rose-200">æˆèª²æ•™å¸«</div>
                            <div class="font-bold">è˜¿æ‹‰éº»å‰ Sonay</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-rose-500 flex items-center justify-center"><i class="fas fa-users"></i></div>
                        <div>
                            <div class="text-xs text-rose-200">ç­ç´š</div>
                            <div class="font-bold">å¹¼æ•™ç³» (åŸå°ˆç­)</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-rose-500 flex items-center justify-center"><i class="far fa-clock"></i></div>
                        <div>
                            <div class="text-xs text-rose-200">æ™‚é–“</div>
                            <div class="font-bold">2026å¹´ 1æœˆ</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-rose-500 flex items-center justify-center"><i class="fas fa-map-marker-alt"></i></div>
                        <div>
                            <div class="text-xs text-rose-200">åœ°é»</div>
                            <div class="font-bold">èªæ–‡æ•™å®¤ (é˜¿ç¾èª)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¿«é€Ÿå…¥å£èˆ‡å…¬å‘Š -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <!-- å¡ç‰‡ 1: æ™‚ç¨‹è¡¨ -->
            <div onclick="switchPage('schedule')" class="home-card bg-white p-6 rounded-2xl shadow-lg border border-slate-100 cursor-pointer group">
                <div class="w-14 h-14 bg-amber-100 text-amber-600 rounded-2xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-800 mb-2">æŸ¥çœ‹æ™‚ç¨‹è¡¨</h3>
                <p class="text-slate-500 text-sm mb-4">Check Presentation Schedule</p>
                <div class="text-xs font-bold text-amber-600 bg-amber-50 px-2 py-1 rounded inline-block">
                    <i class="fas fa-exclamation-circle mr-1"></i> ä¸‹æ¬¡å ±å‘Š: 01/09
                </div>
            </div>

            <!-- å¡ç‰‡ 2: æ¸¬é©—ç³»çµ± -->
            <div onclick="switchPage('exam')" class="home-card bg-white p-6 rounded-2xl shadow-lg border border-slate-100 cursor-pointer group">
                <div class="w-14 h-14 bg-rose-100 text-rose-600 rounded-2xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                    <i class="fas fa-laptop-code"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-800 mb-2">é€²å…¥æ¸¬é©—ç³»çµ±</h3>
                <p class="text-slate-500 text-sm mb-4">Start Exam & Recording</p>
                <div class="text-xs font-bold text-rose-600 bg-rose-50 px-2 py-1 rounded inline-block">
                    åŒ…å«è¨ˆæ™‚å™¨èˆ‡éŒ„éŸ³åŠŸèƒ½
                </div>
            </div>

            <!-- å¡ç‰‡ 3: å¤–éƒ¨è³‡æº -->
            <a href="https://web.klokah.tw/" target="_blank" class="home-card bg-white p-6 rounded-2xl shadow-lg border border-slate-100 cursor-pointer group block">
                <div class="w-14 h-14 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                    <i class="fas fa-book"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-800 mb-2">æ—èª E æ¨‚åœ’</h3>
                <p class="text-slate-500 text-sm mb-4">Learning Resources</p>
                <div class="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded inline-block">
                    å‰å¾€å¤–éƒ¨ç¶²ç«™
                </div>
            </a>
        </div>

        <!-- æœ€æ–°å…¬å‘Š -->
        <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6">
            <h3 class="font-bold text-lg text-slate-800 mb-4 flex items-center gap-2">
                <i class="fas fa-bullhorn text-rose-500"></i> æœ€æ–°å…¬å‘Š (Announcements)
            </h3>
            <div class="space-y-3">
                <div class="flex items-start gap-3 p-3 bg-rose-50 rounded-lg border border-rose-100">
                    <div class="bg-rose-500 text-white text-xs font-bold px-2 py-1 rounded mt-0.5">é‡è¦</div>
                    <div>
                        <div class="font-bold text-slate-800 text-sm">01/09 æœŸæœ«å ±å‘Šæ™‚é–“æ›´æ–°</div>
                        <div class="text-xs text-slate-600 mt-1">è«‹æ³¨æ„ï¼Œ1æœˆ9æ—¥çš„æœŸæœ«å ±å‘Šé–‹å§‹æ™‚é–“å·²èª¿æ•´ç‚º <strong>14:10</strong>ã€‚è«‹åºè™Ÿ 9-15 è™ŸåŒå­¸æº–æ™‚å‡ºå¸­ã€‚</div>
                    </div>
                </div>
                <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-lg border border-slate-100">
                    <div class="bg-slate-400 text-white text-xs font-bold px-2 py-1 rounded mt-0.5">æé†’</div>
                    <div>
                        <div class="font-bold text-slate-800 text-sm">éŒ„éŸ³æª”æ¡ˆä¸‹è¼‰</div>
                        <div class="text-xs text-slate-600 mt-1">æ¸¬é©—çµæŸå¾Œï¼Œè«‹å‹™å¿…é»æ“Šã€Œä¸‹è¼‰éŒ„éŸ³ã€æŒ‰éˆ•ä¿å­˜æ‚¨çš„æª”æ¡ˆï¼Œä¸¦ä¸Šå‚³è‡³ Google è¡¨å–®ã€‚</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- é é¢ 2: æ™‚ç¨‹è¡¨ (Schedule View) -->
    <!-- ========================================== -->
    <div id="view-schedule" class="page-section max-w-5xl mx-auto p-6">
        <div class="bg-white rounded-xl shadow-md p-6 border border-slate-200">
            <header class="mb-6 border-b border-rose-100 pb-4">
                <h1 class="text-2xl font-bold text-rose-800 flex items-center gap-2">
                    <i class="fas fa-list-alt"></i> å ±å‘Šèˆ‡æ¸¬é©—æ™‚ç¨‹è¡¨ 
                    <span class="text-sm font-normal text-slate-500 mt-1 ml-2">Presentation Schedule</span>
                </h1>
            </header>

            <!-- æ‘˜è¦å¡ç‰‡ -->
            <div class="flex gap-4 flex-wrap mb-8">
                <div class="sch-card hover:shadow-md transition-shadow bg-slate-50 opacity-70">
                    <h3 class="font-bold text-slate-700 text-lg mb-1">12/19 æœŸä¸­ (Midterm)</h3>
                    <p class="text-slate-600">ğŸ•’ 14:10 é–‹å§‹</p>
                    <p class="text-slate-500 text-sm">ğŸ“ 1-15è™Ÿ (å·²çµæŸ)</p>
                </div>
                <div class="sch-card hover:shadow-md transition-shadow bg-white">
                    <h3 class="font-bold text-rose-700 text-lg mb-1">01/02 æœŸæœ« (Final)</h3>
                    <p class="text-slate-600">ğŸ•’ <strong>14:10 é–‹å§‹</strong></p>
                    <p class="text-slate-500 text-sm">ğŸ“ 1-8è™Ÿ</p>
                </div>
                <div class="sch-card hover:shadow-md transition-shadow border-l-4 border-rose-500 ring-2 ring-rose-200">
                    <h3 class="font-bold text-rose-700 text-lg mb-1">01/09 æœŸæœ« (Final)</h3>
                    <p class="text-slate-600">ğŸ•’ <strong>14:10 é–‹å§‹</strong></p>
                    <p class="text-slate-500 text-sm">ğŸ“ 9-15è™Ÿ <span class="bg-red-100 text-red-600 px-1 rounded text-xs ml-1 font-bold">Updated</span></p>
                </div>
            </div>

            <!-- 01/09 è©³ç´°è¡¨ -->
            <div class="bg-white border border-slate-200 rounded-lg overflow-hidden mb-4 shadow-sm">
                <div class="bg-rose-800 text-white px-4 py-3 font-bold flex justify-between items-center">
                    <span class="flex items-center gap-2"><i class="far fa-calendar-check"></i> 1æœˆ 9æ—¥ æœŸæœ«å ±å‘Š (9-15è™Ÿ)</span>
                    <span class="text-xs bg-rose-700 px-2 py-1 rounded border border-rose-600">Start 14:10</span>
                </div>
                <div style="overflow-x: auto;">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-50 text-slate-600 text-sm">
                            <tr>
                                <th class="p-3 border-b w-24">ç‹€æ…‹</th>
                                <th class="p-3 border-b w-16">No.</th>
                                <th class="p-3 border-b">å§“å</th>
                                <th class="p-3 border-b">åˆ†çµ„</th>
                                <th class="p-3 border-b">é è¨ˆæ™‚é–“</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm divide-y divide-slate-100">
                            <tr class="hover:bg-rose-50 transition-colors bg-rose-50/30">
                                <td class="p-3"><span class="badge final">æœŸæœ«+å£èªª</span></td>
                                <td class="p-3 font-mono font-bold text-rose-800">10</td>
                                <td class="p-3 font-bold text-slate-700">ç‹å¦¤å›</td>
                                <td class="p-3 text-slate-600">ç§€å§‘å·’é˜¿ç¾ (Siwkolan)</td>
                                <td class="p-3 time-col">14:10 - 14:30</td>
                        
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- é é¢ 3: æ¸¬é©—ç³»çµ± (Exam App View) -->
    <!-- ========================================== -->
    <div id="view-exam" class="page-section">
        
        <!-- å°ˆå±¬æ¨™é¡Œå€ -->
        <div class="page-title-gradient text-white py-8 px-4 mb-8 shadow-inner border-b-4 border-rose-900">
            <div class="max-w-7xl mx-auto text-center">
                <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight mb-2">
                    æœŸæœ«æ¸¬é©—æ§åˆ¶å°
                </h2>
                <div class="mt-4 flex flex-wrap justify-center gap-3 text-xs md:text-sm text-rose-100 opacity-90">
                    <span class="bg-white/20 px-3 py-1 rounded-full border border-white/30"><i class="fas fa-user-circle mr-1"></i> è€ƒç”Ÿï¼šç‹å¦¤å›</span>
                    <span class="bg-white/20 px-3 py-1 rounded-full border border-white/30"><i class="fas fa-language mr-1"></i> ç§€å§‘å·’é˜¿ç¾èª</span>
                </div>
            </div>
        </div>

        <main class="max-w-7xl mx-auto px-4">
            
            <!-- è€ƒç”Ÿåå–®å€å¡Š (ç°¡åŒ–) -->
            <div class="bg-white rounded-2xl shadow-xl border border-slate-200 mb-10 overflow-hidden">
                <div class="bg-slate-50 px-6 py-4 border-b border-slate-200 flex justify-between items-center">
                    <h3 class="font-bold text-slate-800 flex items-center gap-2 text-lg">
                        <i class="fas fa-user-check text-rose-700"></i> 
                        <div>
                            è€ƒç”Ÿè³‡æ–™ç¢ºèª
                            <span class="text-xs font-normal text-slate-500 block uppercase tracking-tight">Student Check-in</span>
                        </div>
                    </h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left student-table">
                        <thead>
                            <tr>
                                <th class="px-6 py-3 text-sm">åºè™Ÿ</th>
                                <th class="px-6 py-3 text-sm">å§“å (å¯ä¿®æ”¹)</th>
                                <th class="px-6 py-3 text-sm">æ—èªåˆ†çµ„</th>
                                <th class="px-6 py-3 text-sm">ç´šåˆ¥</th>
                                <th class="px-6 py-3 text-sm text-center">ç‹€æ…‹ (é»æ“Šåˆ‡æ›)</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr class="hover:bg-rose-50/50 transition-colors">
                                <td class="px-6 py-4 font-mono font-bold text-rose-800 text-lg" id="current-student-id">10</td>
                                <td class="px-6 py-4 font-bold text-slate-800 editable-name" contenteditable="true" id="student-name">
                                    ç‹å¦¤å›
                                </td>
                                <td class="px-6 py-4 text-slate-600 cursor-pointer hover:text-rose-600"><i class="fas fa-university mr-1"></i>ç§€å§‘å·’é˜¿ç¾èª (Siwkolan)</td>
                                <td class="px-6 py-4"><span class="px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-bold ring-1 ring-amber-200">ä¸­é«˜ç´š</span></td>
                                <td class="px-6 py-4 text-sm font-bold text-slate-400 cursor-pointer hover:bg-slate-100 transition-all text-center select-none" onclick="toggleStatus(this)">
                                    <span><i class="far fa-clock mr-1"></i> å¾…å ±å‘Š</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                <!-- å·¦å´ï¼šè€ƒé¡Œå€ -->
                <div class="space-y-8">
                    <!-- Task 1: æœ—è®€è€ƒé¡Œ -->
                    <div class="bg-white p-3 rounded-3xl shadow-lg overflow-hidden border border-slate-200 ring-1 ring-rose-100">
                        <div class="px-5 py-4 border-b flex items-center justify-between bg-rose-50/50">
                            <span class="flex items-center gap-2">
                                <i class="fas fa-book-open text-rose-600 text-xl"></i> 
                                <div>
                                    <h4 class="font-bold text-slate-800">æœ—è®€è€ƒé¡Œ</h4>
                                    <span class="text-[10px] font-normal text-slate-500 block uppercase tracking-tighter italic">Reading Task</span>
                                    <div class="mt-1 text-[10px] text-rose-800 font-bold bg-white/60 px-1.5 py-0.5 rounded border border-rose-200 inline-block">
                                        <i class="fas fa-clock mr-1"></i>å‚™ç­” 2åˆ†é˜ / ä½œç­” 1.5åˆ†é˜
                                    </div>
                                </div>
                            </span>
                            <span class="text-[11px] font-bold text-rose-700 bg-white px-2 py-0.5 rounded border border-rose-200">TASK 1</span>
                        </div>
                        <div class="p-2 bg-slate-50 min-h-[300px] flex items-center justify-center">
                             <!-- ä½¿ç”¨åŸæª”æ¡ˆä¸­çš„æœ—è®€åœ–ç‰‡ -->
                             <img id="task1-img" src="" class="w-full h-auto object-contain rounded-xl shadow-inner">
                        </div>
                    </div>

                    <!-- Task 2: çœ‹åœ–èªªæ•…äº‹è€ƒé¡Œ -->
                    <div class="bg-white p-3 rounded-3xl shadow-lg overflow-hidden border border-slate-200 ring-1 ring-rose-100">
                        <div class="px-5 py-4 border-b flex items-center justify-between bg-slate-50">
                            <span class="flex items-center gap-2">
                                <i class="fas fa-comment-dots text-rose-600 text-xl"></i> 
                                <div>
                                    <h4 class="font-bold text-slate-800">çœ‹åœ–èªªæ•…äº‹è€ƒé¡Œ (è«‹é¸ä¸€é¡Œ)</h4>
                                    <span class="text-[10px] font-normal text-slate-500 block uppercase tracking-tighter italic">Storytelling Task (Select 1 of 3)</span>
                                    <div class="mt-1 text-[10px] text-rose-800 font-bold bg-rose-50 px-1.5 py-0.5 rounded border border-rose-200 inline-block">
                                        <i class="fas fa-clock mr-1"></i>å‚™ç­” 2åˆ†é˜ / ä½œç­” 2åˆ†é˜
                                    </div>
                                </div>
                            </span>
                            <span class="text-[11px] font-bold text-rose-700 bg-white px-2 py-0.5 rounded border border-rose-200">TASK 2</span>
                        </div>
                        
                        <!-- åœ–ç‰‡é¸æ“‡æŒ‰éˆ• -->
                        <div class="px-5 py-3 bg-slate-50 flex gap-2 overflow-x-auto border-b border-slate-100">
                             <button onclick="switchStoryImage(1)" class="flex-1 bg-rose-100 text-rose-700 border-rose-300 ring-2 ring-rose-200 py-2 px-4 rounded-lg border text-sm font-bold transition-all shadow-sm focus:outline-none whitespace-nowrap" id="btn-story-1">
                                <i class="far fa-image mr-1"></i> ä¸»é¡Œ A
                             </button>
                             <button onclick="switchStoryImage(2)" class="flex-1 bg-white hover:bg-rose-50 text-slate-600 hover:text-rose-700 py-2 px-4 rounded-lg border border-slate-200 text-sm font-bold transition-all shadow-sm focus:outline-none whitespace-nowrap" id="btn-story-2">
                                <i class="far fa-image mr-1"></i> ä¸»é¡Œ B
                             </button>
                             <button onclick="switchStoryImage(3)" class="flex-1 bg-white hover:bg-rose-50 text-slate-600 hover:text-rose-700 py-2 px-4 rounded-lg border border-slate-200 text-sm font-bold transition-all shadow-sm focus:outline-none whitespace-nowrap" id="btn-story-3">
                                <i class="far fa-image mr-1"></i> ä¸»é¡Œ C
                             </button>
                        </div>

                        <!-- ä¸»é¡Œèªªæ˜èˆ‡æç¤ºèªé¡¯ç¤ºå€ -->
                        <div id="story-info-box" class="px-6 py-4 bg-amber-50 border-b border-amber-100 mb-0 transition-colors duration-300">
                            <h5 id="story-title" class="font-bold text-slate-800 text-lg mb-2 flex flex-wrap items-center gap-2">
                                <!-- JS å‹•æ…‹å¡«å…¥ -->
                            </h5>
                            <p id="story-prompt" class="text-slate-600 text-sm leading-relaxed">
                                <!-- JS å‹•æ…‹å¡«å…¥ -->
                            </p>
                        </div>

                        <div class="p-2 bg-slate-50 min-h-[300px] flex items-center justify-center">
                            <img id="story-display-img" 
                                 src="" 
                                 alt="Storytelling Exam" 
                                 class="w-full h-auto object-contain rounded-xl shadow-inner transition-opacity duration-300">
                        </div>
                    </div>

                    <!-- è®€ç¨¿å…§å®¹æ–‡å­— (å«éŸ³è¨Šæ’­æ”¾) -->
                    <div class="bg-white p-10 rounded-[2rem] shadow-xl border border-slate-100 relative overflow-hidden ring-1 ring-slate-200">
                        <div class="absolute top-0 right-0 w-24 h-24 bg-rose-500/5 -mr-10 -mt-10 rounded-full"></div>
                        
                        <div class="flex flex-col xl:flex-row justify-between items-start xl:items-center mb-6 gap-4">
                            <h3 class="text-2xl font-bold text-slate-800 border-l-4 border-rose-600 pl-4">
                                æœ—è®€å…§å®¹æ–‡å­— 
                                <span class="text-xs font-normal text-slate-500 block uppercase tracking-wider italic">Reading Text Content</span>
                            </h3>
                            
                            <!-- å…§åµŒå¼åƒè€ƒéŸ³è¨Šæ’­æ”¾å™¨ç¾¤çµ„ -->
                            <div class="flex flex-col gap-2 w-full md:w-auto">
                                <!-- Audio 1 (é˜¿ç¾èªéŸ³æª”) -->
                                <div class="bg-slate-50 border border-slate-200 rounded-xl p-2 flex items-center shadow-sm w-full md:w-auto">
                                     <div class="text-xs font-bold text-slate-400 uppercase px-3 border-r border-slate-200 mr-2 flex flex-col leading-tight min-w-[70px]">
                                        <span><i class="fas fa-headphones-alt text-rose-500 mr-1"></i>åƒè€ƒ 1</span>
                                        <span>Audio 1</span>
                                     </div>
                                     <audio id="ref-audio" controls class="h-8 w-full md:w-60">
                                        <source src="" type="audio/mpeg">
                                    </audio>
                                </div>
                                <!-- Audio 2 (å¦‚éœ€ç¬¬äºŒæ®µéŸ³æª”å¯é–‹å•Ÿï¼Œç›®å‰éš±è—) -->
                                <div id="ref-audio-container-2" class="bg-slate-50 border border-slate-200 rounded-xl p-2 flex items-center shadow-sm w-full md:w-auto hidden">
                                     <div class="text-xs font-bold text-slate-400 uppercase px-3 border-r border-slate-200 mr-2 flex flex-col leading-tight min-w-[70px]">
                                        <span><i class="fas fa-headphones-alt text-rose-500 mr-1"></i>åƒè€ƒ 2</span>
                                        <span>Audio 2</span>
                                     </div>
                                     <audio id="ref-audio-2" controls class="h-8 w-full md:w-60">
                                        <source src="" type="audio/mpeg">
                                    </audio>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4 text-rose-800 font-bold bg-rose-50 px-4 py-2 rounded-lg inline-block text-sm border border-rose-100">
                            ç§€å§‘å·’é˜¿ç¾èª / ç¬¬10éšç¬¬5èª² O losay i palapatan å››å­£ç”¢ç‰©
                        </div>
                        
                        <!-- æœ—è®€å…§å®¹åˆ†æ®µèˆ‡è©•åˆ† -->
                        <div id="content-text">
                            <!-- é€™è£¡çš„å…§å®¹å°‡ç”± JavaScript å‹•æ…‹å¡«å…¥ -->
                        </div>
                    </div>
                </div>

                <!-- å³å´ï¼šè¨ˆæ™‚å™¨ã€æ’­æ”¾å™¨èˆ‡æ–‡æœ¬ -->
                <div class="space-y-8">
                    
                    <!-- æ¸¬é©—è¨ˆæ™‚æ§åˆ¶å° -->
                    <div class="bg-white rounded-[2rem] shadow-xl border border-slate-200 overflow-hidden ring-1 ring-slate-200 sticky top-4 z-40">
                        <div class="bg-slate-800 text-white px-6 py-4 flex justify-between items-center">
                            <h3 class="font-bold text-lg flex items-center gap-2">
                                <i class="fas fa-stopwatch text-yellow-400"></i>
                                æ¸¬é©—è¨ˆæ™‚æ§åˆ¶å°
                                <span class="text-xs font-normal opacity-60 uppercase">Exam Timers</span>
                            </h3>
                        </div>
                        <div class="p-6 grid gap-4">
                            <!-- æº–å‚™æ™‚é–“è¨ˆæ™‚å™¨ (1:30) -->
                            <div id="timer-box-prep" class="bg-amber-50 rounded-xl p-4 border border-amber-100 flex items-center justify-between transition-colors">
                                <div class="flex items-center gap-3">
                                    <div class="bg-amber-100 text-amber-600 w-10 h-10 rounded-full flex items-center justify-center font-bold">1</div>
                                    <div>
                                        <div class="text-xs font-bold text-amber-800 uppercase tracking-wider">æº–å‚™æ™‚é–“ Preparation</div>
                                        <div id="timer-display-prep" class="text-2xl font-mono font-bold text-slate-700">01:30</div>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="startSmartTimer('prep', 90)" class="bg-amber-500 hover:bg-amber-600 text-white px-3 py-1 rounded shadow text-sm font-bold transition-colors"><i class="fas fa-play"></i></button>
                                    <button onclick="resetTimer('prep', 90)" class="bg-white text-slate-400 hover:text-slate-600 px-3 py-1 rounded border border-slate-200 shadow-sm text-sm font-bold transition-colors"><i class="fas fa-redo"></i></button>
                                </div>
                            </div>

                            <!-- æœ—è®€ä½œç­”è¨ˆæ™‚å™¨ (2:00) -->
                            <div id="timer-box-read" class="bg-rose-50 rounded-xl p-4 border border-rose-100 flex items-center justify-between transition-colors">
                                <div class="flex items-center gap-3">
                                    <div class="bg-rose-100 text-rose-600 w-10 h-10 rounded-full flex items-center justify-center font-bold">2</div>
                                    <div>
                                        <div class="text-xs font-bold text-rose-800 uppercase tracking-wider">æœ—è®€ä½œç­” Reading</div>
                                        <div id="timer-display-read" class="text-2xl font-mono font-bold text-slate-700">02:00</div>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="startSmartTimer('read', 120)" class="bg-rose-600 hover:bg-rose-700 text-white px-3 py-1 rounded shadow text-sm font-bold transition-colors"><i class="fas fa-play"></i></button>
                                    <button onclick="resetTimer('read', 120)" class="bg-white text-slate-400 hover:text-slate-600 px-3 py-1 rounded border border-slate-200 shadow-sm text-sm font-bold transition-colors"><i class="fas fa-redo"></i></button>
                                </div>
                            </div>

                            <!-- çœ‹åœ–èªªæ•…äº‹è¨ˆæ™‚å™¨ (2:00) -->
                            <div id="timer-box-story" class="bg-blue-50 rounded-xl p-4 border border-blue-100 flex items-center justify-between transition-colors">
                                <div class="flex items-center gap-3">
                                    <div class="bg-blue-100 text-blue-600 w-10 h-10 rounded-full flex items-center justify-center font-bold">3</div>
                                    <div>
                                        <div class="text-xs font-bold text-blue-800 uppercase tracking-wider">èªªæ•…äº‹ Storytelling</div>
                                        <div id="timer-display-story" class="text-2xl font-mono font-bold text-slate-700">02:00</div>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="startSmartTimer('story', 120)" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded shadow text-sm font-bold transition-colors"><i class="fas fa-play"></i></button>
                                    <button onclick="resetTimer('story', 120)" class="bg-white text-slate-400 hover:text-slate-600 px-3 py-1 rounded border border-slate-200 shadow-sm text-sm font-bold transition-colors"><i class="fas fa-redo"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- éŒ„éŸ³æ©Ÿèˆ‡å…§å®¹å€å¡Š -->
                    <div class="flex flex-col gap-4">
                        
                        <!-- ç·šä¸ŠéŒ„éŸ³æ©Ÿ (Task 1 & Task 2) -->
                        <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6">
                            <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-microphone-alt text-rose-500"></i>
                                ç·šä¸ŠéŒ„éŸ³ä½œç­” (éœ€éŒ„è£½ä¸‰æ®µ)
                                <span class="text-xs font-normal text-slate-500 uppercase">Record All 3 Tasks</span>
                            </h3>

                            <!-- Recorder 1: Midterm Reading -->
                            <div class="mb-6 border-b border-slate-100 pb-6">
                                <h4 class="font-bold text-sm text-slate-700 mb-2">1. æœŸä¸­æœ—è®€æ¸¬é©—éŒ„éŸ³ (Midterm Reading)</h4>
                                <div class="flex flex-col gap-3">
                                    <div class="flex gap-2 justify-center">
                                        <button id="btn-record-start-1" onclick="startRecording(1)" class="flex-1 bg-white border-2 border-slate-200 text-slate-600 hover:border-rose-500 hover:text-rose-500 py-2 rounded-xl font-bold transition-all flex items-center justify-center gap-2 text-sm">
                                            <i class="fas fa-circle"></i> é–‹å§‹éŒ„éŸ³
                                        </button>
                                        <button id="btn-record-stop-1" onclick="stopRecording(1)" disabled class="flex-1 bg-slate-100 text-slate-400 py-2 rounded-xl font-bold transition-all flex items-center justify-center gap-2 text-sm">
                                            <i class="fas fa-square"></i> åœæ­¢
                                        </button>
                                    </div>
                                    <div id="recording-status-1" class="text-center text-xs text-slate-400 h-4"></div>
                                    <audio id="recorded-audio-1" controls class="w-full hidden h-8"></audio>
                                    <a id="btn-download-record-1" href="#" style="display:none" class="w-full bg-slate-700 hover:bg-slate-800 text-white py-2 rounded-lg text-center font-bold text-sm transition-colors">
                                        <i class="fas fa-download mr-2"></i> ä¸‹è¼‰æœŸä¸­éŒ„éŸ³
                                    </a>
                                </div>
                            </div>

                            <!-- Recorder 2: Final Reading -->
                            <div class="mb-6 border-b border-slate-100 pb-6">
                                <h4 class="font-bold text-sm text-slate-700 mb-2">2. æœŸæœ«æœ—è®€æ¸¬é©—éŒ„éŸ³ (Final Reading)</h4>
                                <div class="flex flex-col gap-3">
                                    <div class="flex gap-2 justify-center">
                                        <button id="btn-record-start-2" onclick="startRecording(2)" class="flex-1 bg-white border-2 border-slate-200 text-slate-600 hover:border-rose-500 hover:text-rose-500 py-2 rounded-xl font-bold transition-all flex items-center justify-center gap-2 text-sm">
                                            <i class="fas fa-circle"></i> é–‹å§‹éŒ„éŸ³
                                        </button>
                                        <button id="btn-record-stop-2" onclick="stopRecording(2)" disabled class="flex-1 bg-slate-100 text-slate-400 py-2 rounded-xl font-bold transition-all flex items-center justify-center gap-2 text-sm">
                                            <i class="fas fa-square"></i> åœæ­¢
                                        </button>
                                    </div>
                                    <div id="recording-status-2" class="text-center text-xs text-slate-400 h-4"></div>
                                    <audio id="recorded-audio-2" controls class="w-full hidden h-8"></audio>
                                    <a id="btn-download-record-2" href="#" style="display:none" class="w-full bg-slate-700 hover:bg-slate-800 text-white py-2 rounded-lg text-center font-bold text-sm transition-colors">
                                        <i class="fas fa-download mr-2"></i> ä¸‹è¼‰æœŸæœ«éŒ„éŸ³
                                    </a>
                                </div>
                            </div>

                            <!-- Recorder 3: Storytelling -->
                            <div>
                                <h4 class="font-bold text-sm text-slate-700 mb-2">3. çœ‹åœ–èªªæ•…äº‹éŒ„éŸ³ (Storytelling Task)</h4>
                                <div class="flex flex-col gap-3">
                                    <div class="flex gap-2 justify-center">
                                        <button id="btn-record-start-3" onclick="startRecording(3)" class="flex-1 bg-white border-2 border-slate-200 text-slate-600 hover:border-blue-500 hover:text-blue-500 py-2 rounded-xl font-bold transition-all flex items-center justify-center gap-2 text-sm">
                                            <i class="fas fa-circle"></i> é–‹å§‹éŒ„éŸ³
                                        </button>
                                        <button id="btn-record-stop-3" onclick="stopRecording(3)" disabled class="flex-1 bg-slate-100 text-slate-400 py-2 rounded-xl font-bold transition-all flex items-center justify-center gap-2 text-sm">
                                            <i class="fas fa-square"></i> åœæ­¢
                                        </button>
                                    </div>
                                    <div id="recording-status-3" class="text-center text-xs text-slate-400 h-4"></div>
                                    <audio id="recorded-audio-3" controls class="w-full hidden h-8"></audio>
                                    <a id="btn-download-record-3" href="#" style="display:none" class="w-full bg-slate-700 hover:bg-slate-800 text-white py-2 rounded-lg text-center font-bold text-sm transition-colors">
                                        <i class="fas fa-download mr-2"></i> ä¸‹è¼‰èªªæ•…äº‹éŒ„éŸ³
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- éŒ„éŸ³ä¸Šå‚³ä½œç­”é€£çµ -->
                        <a href="#" onclick="openGoogleFormWithData(event, 'audio')" class="w-full bg-gradient-to-r from-rose-600 to-rose-700 hover:from-rose-500 hover:to-rose-600 text-white rounded-xl p-4 flex items-center justify-between shadow-lg transition-all group border border-rose-500 cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-white/20 w-10 h-10 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <i class="fas fa-cloud-upload-alt text-white"></i>
                                </div>
                                <div class="text-left">
                                    <div class="font-bold text-lg">éŒ„éŸ³ä¸Šå‚³ä½œç­” (è‡ªå‹•å¡«å…¥å§“å)</div>
                                    <div class="text-xs text-rose-100 uppercase">1. ä¸‹è¼‰éŒ„éŸ³ -> 2. é»æ­¤ä¸Šå‚³æª”æ¡ˆ</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right text-rose-200 group-hover:text-white transition-colors"></i>
                        </a>

                        <!-- æ‰‹ç¨¿ä¸Šå‚³ä½œç­”é€£çµ -->
                        <a href="#" onclick="openGoogleFormWithData(event, 'manuscript')" class="w-full bg-gradient-to-r from-sky-600 to-sky-700 hover:from-sky-500 hover:to-sky-600 text-white rounded-xl p-4 flex items-center justify-between shadow-lg transition-all group border border-sky-500 cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-white/20 w-10 h-10 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <i class="fas fa-file-alt text-white"></i>
                                </div>
                                <div class="text-left">
                                    <div class="font-bold text-lg">ä¸Šå‚³çœ‹åœ–èªªæ•…äº‹æ‰‹ç¨¿</div>
                                    <div class="text-xs text-sky-100 uppercase">è«‹ä¸Šå‚³æ‚¨çš„æ•…äº‹æ‰‹ç¨¿ (Google è¡¨å–®)</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right text-sky-200 group-hover:text-white transition-colors"></i>
                        </a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <footer class="mt-16 text-center text-slate-400 text-sm py-8 border-t border-slate-200 bg-white">
        <p>ç§€å§‘å·’é˜¿ç¾èª | æœŸæœ«å ±å‘Šèªè­‰è©•é‡è¼”åŠ©ç³»çµ±</p>
        <p class="mt-1 italic uppercase tracking-widest text-[10px]">Â© 2026 Final Evaluation Management System (Siwkolan 'Amis)</p>
    </footer>

    <script>
        // --- é é¢åˆ‡æ› ---
        function switchPage(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => { el.classList.remove('active'); el.classList.add('inactive'); });
            
            document.getElementById(`view-${pageId}`).classList.add('active');
            
            const activeBtn = document.getElementById(`nav-${pageId}`);
            if(activeBtn) {
                activeBtn.classList.remove('inactive');
                activeBtn.classList.add('active');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- éŸ³æ•ˆèˆ‡èªéŸ³æç¤º ---
        const synth = window.speechSynthesis;

        function playDing() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();

            osc.type = 'sine';
            osc.frequency.setValueAtTime(880, ctx.currentTime); // A5
            osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.5); // Drop to A4
            
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);

            osc.connect(gain);
            gain.connect(ctx.destination);

            osc.start();
            osc.stop(ctx.currentTime + 0.5);
        }

        function speakText(text, onEndCallback) {
            if (synth.speaking) {
                synth.cancel(); // Cancel previous if any
            }
            if (text !== '') {
                const utterThis = new SpeechSynthesisUtterance(text);
                utterThis.rate = 0.9;
                utterThis.pitch = 1;
                if (onEndCallback) {
                    utterThis.onend = onEndCallback;
                }
                synth.speak(utterThis);
            } else {
                if (onEndCallback) onEndCallback();
            }
        }

        // --- è©•åˆ†æŒ‰éˆ•åŠŸèƒ½ ---
        window.togglePassFail = function(btn, status) {
            const parent = btn.parentElement;
            // æ¸…é™¤åŒçµ„æŒ‰éˆ•æ¨£å¼
            parent.querySelectorAll('button').forEach(b => {
                b.classList.remove('bg-green-600', 'bg-red-600', 'text-white', 'ring-2', 'ring-offset-1');
                b.classList.add('bg-white', 'text-slate-600', 'border-slate-300');
            });

            // è¨­å®šç•¶å‰æŒ‰éˆ•æ¨£å¼
            if (status === 'pass') {
                btn.classList.remove('bg-white', 'text-slate-600', 'border-slate-300');
                btn.classList.add('bg-green-600', 'text-white', 'border-green-600', 'ring-2', 'ring-green-200', 'ring-offset-1');
            } else {
                btn.classList.remove('bg-white', 'text-slate-600', 'border-slate-300');
                btn.classList.add('bg-red-600', 'text-white', 'border-red-600', 'ring-2', 'ring-red-200', 'ring-offset-1');
            }
        };

        // --- è€ƒç”Ÿç‹€æ…‹åˆ‡æ›åŠŸèƒ½ ---
        window.toggleStatus = function(el) {
            if (el.innerText.includes('å¾…å ±å‘Š')) {
                el.innerHTML = '<span class="text-emerald-600 font-bold"><i class="fas fa-check-circle mr-1"></i> å ±å‘Šå®Œæˆ</span>';
                el.classList.add('bg-emerald-50');
                el.classList.remove('text-slate-400');
            } else {
                el.innerHTML = '<span><i class="far fa-clock mr-1"></i> å¾…å ±å‘Š</span>';
                el.classList.remove('bg-emerald-50');
                el.classList.add('text-slate-400');
            }
        };

        // --- çœ‹åœ–èªªæ•…äº‹åœ–ç‰‡èˆ‡æ–‡å­—åˆ‡æ›é‚è¼¯ ---
        const storyData = {
            1: {
                img: "https://res.cloudinary.com/dm1ksvptk/image/upload/v1767049285/1%E7%9C%8B%E5%9C%96%E8%AA%AA%E6%95%85%E4%BA%8B_rqomyg.png",
                title: 'ä¸»é¡ŒA æ‹œè¨ªçˆºçˆºå¥¶å¥¶çš„ä¸€å¤© <span class="text-sm font-normal text-slate-500 ml-2">Visiting Grandma\'s Day</span>',
                prompt: '<span class="font-bold text-slate-500 mr-1 bg-white px-1.5 rounded border border-slate-200 text-xs">æç¤º Prompt</span> æ‹œè¨ªçˆºçˆºå¥¶å¥¶çš„ä¸€å¤© (Visiting Grandma\'s Day)..... <br><span class="text-rose-700 font-bold italic block mt-1 text-base pl-2 border-l-2 border-rose-300">Yo cecay a romiÊ¼ad a milisoÊ¼ ci akongan aci ama:an</span>'
            },
            2: {
                img: "https://res.cloudinary.com/dm1ksvptk/image/upload/v1767044762/%E8%9E%A2%E5%B9%95%E6%93%B7%E5%8F%96%E7%95%AB%E9%9D%A2_2025-12-30_054318_ky2ivg.png",
                title: 'ä¸»é¡ŒB æˆ‘å–œæ­¡çš„æ´»å‹• <span class="text-sm font-normal text-slate-500 ml-2">My Favorite Activity</span>',
                prompt: '<span class="font-bold text-slate-500 mr-1 bg-white px-1.5 rounded border border-slate-200 text-xs">æç¤º Prompt</span> æˆ‘å–œæ­¡åšä»€éº¼...... <br><span class="text-rose-700 font-bold italic block mt-1 text-base pl-2 border-l-2 border-rose-300">O maan ko kaolahan no mako a demak</span>'
            },
            3: {
                img: "https://res.cloudinary.com/dm1ksvptk/image/upload/v1767049291/2_%E5%92%8C%E5%AE%B6%E4%BA%BA%E5%9B%9E%E9%83%A8%E8%90%BD_%E7%9C%8B%E5%9C%96%E8%AA%AA%E6%95%85%E4%BA%8B_mtpfg8.png",
                title: 'ä¸»é¡ŒC å’Œå®¶äººå›éƒ¨è½ <span class="text-sm font-normal text-slate-500 ml-2">A Trip Back to the Village with My Family</span>',
                prompt: '<span class="font-bold text-slate-500 mr-1 bg-white px-1.5 rounded border border-slate-200 text-xs">æç¤º Prompt</span> å’Œå®¶äººå›éƒ¨è½ (A Trip Back to the Village with My Family)..... <br><span class="text-rose-700 font-bold italic block mt-1 text-base pl-2 border-l-2 border-rose-300">Minokay kako ato paro no lomaÊ¼</span>'
            }
        };

        window.switchStoryImage = function(id) {
            const imgEl = document.getElementById('story-display-img');
            const titleEl = document.getElementById('story-title');
            const promptEl = document.getElementById('story-prompt');
            const infoBox = document.getElementById('story-info-box');

            const data = storyData[id];

            imgEl.style.opacity = '0.5';
            setTimeout(() => {
                imgEl.src = data.img;
                titleEl.innerHTML = data.title;
                promptEl.innerHTML = data.prompt;
                imgEl.style.opacity = '1';
                infoBox.classList.add('bg-yellow-100');
                setTimeout(() => infoBox.classList.remove('bg-yellow-100'), 300);
            }, 150);

            document.querySelectorAll('[id^="btn-story-"]').forEach(btn => {
                btn.className = "flex-1 bg-white hover:bg-rose-50 text-slate-600 hover:text-rose-700 py-2 px-4 rounded-lg border border-slate-200 text-sm font-bold transition-all shadow-sm focus:outline-none whitespace-nowrap";
            });

            const activeBtn = document.getElementById(`btn-story-${id}`);
            activeBtn.className = "flex-1 bg-rose-100 text-rose-700 border-rose-300 ring-2 ring-rose-200 py-2 px-4 rounded-lg border text-sm font-bold transition-all shadow-sm focus:outline-none whitespace-nowrap";
        };

        // --- è€ƒé¡Œè³‡æ–™åº« (ç§€å§‘å·’é˜¿ç¾èª) ---
        const examData = {
            central: {
                student: "ç‹å¦¤å›",
                title: "ç§€å§‘å·’é˜¿ç¾èª / ç¬¬10éšç¬¬5èª² : O losay i palapatan å››å­£ç”¢ç‰©",
                audio: "https://res.cloudinary.com/dm1ksvptk/video/upload/v1766045333/%E7%A7%80%E5%A7%91%E5%B7%9210%E9%9A%8E-5%E8%AA%B2_6_mgtegj.mp3",
                audio2: "https://res.cloudinary.com/dm1ksvptk/video/upload/v1767243460/%E7%A7%80%E9%98%BF%E7%AC%AC10%E9%9A%8E5-2_yjmgkm.mp3",
                textMidterm: "O kafarawfawan a palapatan i, malo:fic ko karoâ€™, makacikarokaroâ€™ ko lomalomaâ€™, nengneng han ko folad to dadaya^, sa taengad sa malikat, matiya^ o karoâ€™ ato folad ko paro^ no lomaâ€™ a marikec.",
                textFinal: "O kasienawan i, o kacikolangan, adihay ko kolang ato saytaw, malo sasakiroen no matoâ€™asay ko saytaw, ta mangaâ€™ay a maâ€™anang ko kasasiromaroma^ no dateng.",
                task1: "https://res.cloudinary.com/dm1ksvptk/image/upload/v1767211969/siwkolan_final_2_xasie4.png"
            }
        };

        // åˆå§‹åŒ–è¼‰å…¥
        window.addEventListener('DOMContentLoaded', () => {
            window.switchPage('home'); // é è¨­é€²å…¥é¦–é 
            window.switchStoryImage(1); // åˆå§‹åŒ–æ•…äº‹
            
            // è¼‰å…¥è€ƒé¡Œè³‡æ–™
            const data = examData.central;
            // æ›´æ–° Task 1 åœ–ç‰‡
            document.getElementById('task1-img').src = data.task1;

            const textHTML = `
                <div class="mb-6 relative">
                    <span class="inline-block bg-slate-200 text-slate-600 text-xs font-bold px-2 py-1 rounded mb-2 uppercase tracking-wide">ç¬¬ä¸€æ®µï¼šæœŸä¸­æ¸¬é©— (Midterm)</span>
                    <div class="amis-text text-xl md:text-2xl text-slate-700 italic font-medium leading-loose text-justify mb-2">
                        "${data.textMidterm}"
                    </div>
                    <div class="flex gap-2 justify-end">
                        <button onclick="togglePassFail(this, 'pass')" class="px-3 py-1 rounded border border-slate-300 text-slate-600 text-xs font-bold bg-white hover:bg-slate-50 transition-all"><i class="fas fa-check mr-1"></i> é€šé</button>
                        <button onclick="togglePassFail(this, 'fail')" class="px-3 py-1 rounded border border-slate-300 text-slate-600 text-xs font-bold bg-white hover:bg-slate-50 transition-all"><i class="fas fa-times mr-1"></i> ä¸é€šé</button>
                    </div>
                </div>
                <hr class="border-dashed border-slate-300 my-4">
                <div class="mb-2 relative">
                    <span class="inline-block bg-rose-100 text-rose-700 text-xs font-bold px-2 py-1 rounded mb-2 uppercase tracking-wide">ç¬¬äºŒæ®µï¼šæœŸæœ«æ¸¬é©— (Final)</span>
                    <div class="amis-text text-xl md:text-2xl text-slate-700 italic font-medium leading-loose text-justify mb-2">
                        "${data.textFinal}"
                    </div>
                    <div class="flex gap-2 justify-end">
                        <button onclick="togglePassFail(this, 'pass')" class="px-3 py-1 rounded border border-slate-300 text-slate-600 text-xs font-bold bg-white hover:bg-slate-50 transition-all"><i class="fas fa-check mr-1"></i> é€šé</button>
                        <button onclick="togglePassFail(this, 'fail')" class="px-3 py-1 rounded border border-slate-300 text-slate-600 text-xs font-bold bg-white hover:bg-slate-50 transition-all"><i class="fas fa-times mr-1"></i> ä¸é€šé</button>
                    </div>
                </div>
            `;
            document.getElementById('content-text').innerHTML = textHTML;

            // è¨­ç½®éŸ³æª”
            const audioPlayer = document.getElementById('ref-audio');
            audioPlayer.src = data.audio;
            audioPlayer.load();

            const audioContainer2 = document.getElementById('ref-audio-container-2');
            const audioPlayer2 = document.getElementById('ref-audio-2');

            if (data.audio2) {
                audioContainer2.classList.remove('hidden');
                audioContainer2.classList.add('flex');
                audioPlayer2.src = data.audio2;
                audioPlayer2.load();
            }
        });

        // --- Google è¡¨å–®é€£å‹•è¨­å®šå€ ---
        const GOOGLE_FORM_CONFIG = {
            baseUrl: "https://docs.google.com/forms/d/e/1FAIpQLScw9CAMHpsx6LWkpnLOE3t9-ZEhgjqicvjOMWfKRvleNOXTAw/viewform", // è«‹æ›¿æ›ç‚ºæ‚¨çš„è¡¨å–®
            manuscriptBaseUrl: "https://docs.google.com/forms/d/e/1FAIpQLScw9CAMHpsx6LWkpnLOE3t9-ZEhgjqicvjOMWfKRvleNOXTAw/viewform",
            idField: "entry.442745491",  // è«‹ç¢ºèªæ‚¨çš„ Form ID
            nameField: "entry.1152993152"
        };

        window.openGoogleFormWithData = function(e, type) {
            e.preventDefault();
            
            const studentId = "10"; // ç‹å¦¤å›
            const studentName = document.getElementById('student-name').innerText.trim();

            const targetUrl = (type === 'manuscript') 
                              ? GOOGLE_FORM_CONFIG.manuscriptBaseUrl 
                              : GOOGLE_FORM_CONFIG.baseUrl;

            const finalUrl = `${targetUrl}?usp=pp_url&${GOOGLE_FORM_CONFIG.idField}=${encodeURIComponent(studentId)}&${GOOGLE_FORM_CONFIG.nameField}=${encodeURIComponent(studentName)}`;
            window.open(finalUrl, '_blank');
        };

        // --- è¨ˆæ™‚å™¨é‚è¼¯ ---
        let intervals = { prep: null, read: null, story: null };

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m < 10 ? '0' + m : m}:${s < 10 ? '0' + s : s}`;
        }

        window.startSmartTimer = function(type, duration) {
            if (intervals[type]) clearInterval(intervals[type]);
            
            // UI elements
            const display = document.getElementById(`timer-display-${type}`);
            const box = document.getElementById(`timer-box-${type}`);
            
            // 1. Play Ding
            playDing();

            // 2. Define Text
            let msg = "";
            switch(type) {
                case 'prep':
                    msg = "æº–å‚™æ™‚é–“ï¼Œä¸€åˆ†ä¸‰åç§’ã€‚ Preparation time, one minute and thirty seconds.";
                    break;
                case 'read':
                    msg = "é–‹å§‹æœ—è®€ä½œç­”ï¼Œè¨ˆæ™‚å…©åˆ†é˜ã€‚ Start reading task, two minutes.";
                    break;
                case 'story':
                    msg = "è¨ˆæ™‚èªªæ•…äº‹ï¼Œå…©åˆ†é˜ã€‚ Storytelling task, two minutes.";
                    break;
            }

            // 3. Define Timer Logic
            const runTimer = () => {
                let timer = duration;
                box.classList.add('timer-running');
                
                // Update immediately to show starting time
                display.textContent = formatTime(timer);

                intervals[type] = setInterval(function () {
                    timer--;
                    if (timer < 0) {
                        clearInterval(intervals[type]);
                        box.classList.remove('timer-running');
                        alert(`${type === 'prep' ? 'æº–å‚™æ™‚é–“' : type === 'read' ? 'æœ—è®€' : 'èªªæ•…äº‹'} æ™‚é–“åˆ°ï¼`);
                        return;
                    }
                    display.textContent = formatTime(timer);
                    if (timer <= 10) display.classList.add('text-red-600');
                }, 1000);
            };

            // 4. Execute: All types now wait for speech to end
            speakText(msg, runTimer);
        };

        window.resetTimer = function(type, duration) {
            if (intervals[type]) clearInterval(intervals[type]);
            const display = document.getElementById(`timer-display-${type}`);
            const box = document.getElementById(`timer-box-${type}`);
            display.textContent = formatTime(duration);
            display.classList.remove('text-red-600');
            box.classList.remove('timer-running');
            synth.cancel(); // Stop speaking if reset
        };

        // --- éŒ„éŸ³æ©Ÿé‚è¼¯ (MediaRecorder) ---
        const recorders = {
            1: { mediaRecorder: null, chunks: [] },
            2: { mediaRecorder: null, chunks: [] },
            3: { mediaRecorder: null, chunks: [] }
        };

        window.startRecording = async function(id) {
            const btnStart = document.getElementById(`btn-record-start-${id}`);
            const btnStop = document.getElementById(`btn-record-stop-${id}`);
            const statusTxt = document.getElementById(`recording-status-${id}`);
            const audioPlayback = document.getElementById(`recorded-audio-${id}`);
            const btnDownload = document.getElementById(`btn-download-record-${id}`);

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                recorders[id].mediaRecorder = new MediaRecorder(stream);
                recorders[id].chunks = [];

                recorders[id].mediaRecorder.addEventListener("dataavailable", event => {
                    recorders[id].chunks.push(event.data);
                });

                recorders[id].mediaRecorder.addEventListener("stop", () => {
                    const audioBlob = new Blob(recorders[id].chunks, { type: 'audio/webm' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    audioPlayback.src = audioUrl;
                    audioPlayback.classList.remove('hidden');
                    
                    const time = new Date();
                    const timestamp = `${time.getHours()}${time.getMinutes()}`;
                    let filename = '';
                    
                    if (id === 1) filename = `Amis_Midterm_Reading_${timestamp}.webm`;
                    else if (id === 2) filename = `Amis_Final_Reading_${timestamp}.webm`;
                    else filename = `Amis_Story_${timestamp}.webm`;
                    
                    btnDownload.href = audioUrl;
                    btnDownload.download = filename;
                    btnDownload.style.display = 'block';
                    
                    statusTxt.textContent = "éŒ„éŸ³å®Œæˆï¼è«‹è©¦è½æˆ–ä¸‹è¼‰";
                });

                recorders[id].mediaRecorder.start();
                
                btnStart.disabled = true;
                btnStart.classList.add('recording-active');
                btnStart.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> éŒ„éŸ³ä¸­...';
                btnStop.disabled = false;
                btnStop.classList.remove('bg-slate-100', 'text-slate-400');
                btnStop.classList.add('bg-slate-800', 'text-white', 'hover:bg-slate-700');
                statusTxt.textContent = "æ­£åœ¨éŒ„éŸ³... (Recording)";
                audioPlayback.classList.add('hidden');
                btnDownload.style.display = 'none';

            } catch (err) {
                console.error("Error accessing microphone:", err);
                alert("ç„¡æ³•å­˜å–éº¥å…‹é¢¨ï¼Œè«‹ç¢ºèªç€è¦½å™¨æ¬Šé™è¨­å®šã€‚");
            }
        };

        window.stopRecording = function(id) {
            const recorder = recorders[id].mediaRecorder;
            const btnStart = document.getElementById(`btn-record-start-${id}`);
            const btnStop = document.getElementById(`btn-record-stop-${id}`);

            if (recorder && recorder.state !== 'inactive') {
                recorder.stop();
                btnStart.disabled = false;
                btnStart.classList.remove('recording-active');
                btnStart.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> é‡æ–°éŒ„éŸ³';
                btnStop.disabled = true;
                btnStop.classList.remove('bg-slate-800', 'text-white', 'hover:bg-slate-700');
                btnStop.classList.add('bg-slate-100', 'text-slate-400');
            }
        };
    </script>
</body>
</html>
